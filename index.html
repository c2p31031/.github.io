<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Realtime Location Sharing with Google Maps</title>
    <!-- Firebase JavaScript SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <!-- Google Maps JavaScript API -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAFcyIINxfRta3BSgR66oUdlS6BPEcnLsA&libraries=places"></script>
    <style>
        #map {
            height: 400px;
        }
    </style>
</head>
<body>
    <h1>Realtime Location Sharing with Google Maps</h1>

    <div id="map"></div>

    <!-- Your Firebase config -->
    <script>
        var firebaseConfig = {
            apiKey: "AIzaSyB68Y_y4DfeuUIFuKbzZc-vXc8szmQyhUA",
            authDomain: "kokoiru-f0404.firebaseapp.com",
            databaseURL: "https://kokoiru-f0404-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "kokoiru-f0404",
            storageBucket: "kokoiru-f0404.appspot.com",
            messagingSenderId: "341276960063",
            appId: "1:341276960063:web:1177a1eefce269a6c25f8a"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);

        // Reference to the Firebase database
        var database = firebase.database();

        // Reference to the 'locations' node in the Firebase database
        var locationsRef = database.ref('locations');

        // Initialize Google Maps
        var map;
        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                center: {lat: 0, lng: 0},
                zoom: 2
            });

            // Get user's location and update it in real-time
            navigator.geolocation.getCurrentPosition(function(position) {
                var userLocation = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude
                };

                // Save the user's location in the database
                firebase.database().ref('locations').push(userLocation);
                
                // Add a marker for the user's current location
                var userMarker = new google.maps.Marker({
                    position: userLocation,
                    map: map,
                    title: "Your Location"
                });

                // Center the map on the user's location
                map.setCenter(userLocation);
            });

            // Load and display existing locations from Firebase
            locationsRef.on('child_added', function(snapshot) {
                var location = snapshot.val();
                addMarker(location);
            });

            // Update markers in real-time when location changes
            locationsRef.on('child_changed', function(snapshot) {
                var location = snapshot.val();
                updateMarker(location);
            });

            // Remove markers when a location is removed from Firebase
            locationsRef.on('child_removed', function(snapshot) {
                var location = snapshot.val();
                removeMarker(location);
            });
        }

        // Your map-related JavaScript code here (using Google Maps API)
        function addMarker(location) {
            var marker = new google.maps.Marker({
                position: {lat: location.lat, lng: location.lng},
                map: map,
                title: "Friend's Location"
            });

            // Save the marker reference in the location object
            location.marker = marker;
        }

        function updateMarker(location) {
            // Update the position of the existing marker
            location.marker.setPosition({lat: location.lat, lng: location.lng});
        }

        function removeMarker(location) {
            // Remove the marker from the map
            location.marker.setMap(null);
        }
    </script>

    <!-- Load Google Maps and initialize the map -->
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAFcyIINxfRta3BSgR66oUdlS6BPEcnLsA&libraries=places&callback=initMap">
    </script>
</body>
</html>

